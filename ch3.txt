概要设计

3.1 目标与概述
本设计将实现一个B2B电子商务平台的用户管理应用，该应用将包含用户搜索、用户信息查看、企业成员管理、企业账号配置等功能，为该B2B电子商务平台的管理人员提供一个高效的管理工具。
本设计需要在设计完成后，能实现以下功能：
1.	只有平台的管理人员才有权限访问该应用。
2.	管理人员登录后，可以通过多种关键词来搜索特定用户。
3.	在普通用户账号管理界面中，用户可以查看到用户账号、请求日志等详细信息，还可通过控制选项对该用户账号进行配置。
4.	在企业账号管理界面中，用户可以查看到企业账号、企业成员等详细信息，还可通过账号类型管理、单点登录等模块进行对该账号进行相应配置。
5.	在企业成员管理界面中，用户可以查看到隶属于该组织的所有成员的基本信息，还可以进行成员添加和删除操作。
另外，本设计还要同时保证安全性、可测试性以及可维护性三项要求。安全性是指该应用不能被没有管理员权限的账号访问到，这就要求在该应用的实现上要考虑对用户的角色类型进行检查，防止所有未经授权的操作，维护系统的稳定性和安全性。可测试性是指该应用要进行模块化设计，每个模块的逻辑单元都要有相应的单元测试，对于整个应用所涉及的所有系统组件，要有相应的集成测试来确保它们能够协同工作，这样有助于开发人员在早期发现问题，有利于程序的调试，提升开发效率。可维护性是指在开发过程中，要保证代码风格与原系统保持一致，代码逻辑清晰规范，所有代码必须通过同行评审后方可采用，这样同时也有利于系统的持续开发。
3.2 系统总体架构设计
本电子商务平台基本架构包括前端服务器、代理服务器、普通后端服务器、应用服务后端服务器、应用服务器、应用仓库以及数据库。平台基本架构图如图4所示。
以上每个功能组件的作用如下：
(1)	前端服务器
按照系统架构，前端服务器位于系统边缘，负责接收所有系统外部的Web请求，根据请求类型从相应的系统组件获得数据或资源响应用户。此外，平台的UI部分资源主要存放在前端服务器上。
(2)	代理服务器
代理服务器位于前端服务器和后端服务器之间，后端服务器分为普通后端服务器和应用后端服务器两种。代理服务器需要根据前端服务器发来的请求URL的不同来决定将请求转发给普通后端服务器还是应用后端服务器。另外有关OAuth验证过程也是在代理服务器上处理的。

图4 平台整体架构图
(3)	普通后端服务器
除了有关应用资源是由应用服务后端服务器管理外，所有其他系统资源的管理和业务逻辑都是由普通后端服务器负责的。
(4)	应用服务后端服务器
所有有关应用的服务都是由应用服务后端服务器提供。应用服务后端服务器和普通后端服务器都属于后端服务器，只是它们各自提供的内容不一样。将应用服务后端服务器和普通后端服务器分开，一方面能减少普通后端服务器的压力，另一方面使得系统更加模块化，有利于各模块的稳定。
(5)	应用服务器
应用服务器是一个独立的Web服务器，它的主要任务是能够监控应用仓库的变化，即时构建应用并向应用服务器后端服务器注册应用。只有被应用服务器构建成功并向应用服务后端服务器注册成功的应用才能出现在系统的应用商店里，用户通过应用商店激活相应应用就可以使用该应用提供的服务了。
(6)	应用仓库
应用仓库中存放着所有平台内置的应用，它是内部开发的应用的集合。只要按照系统的开发约定，即可方便地生成应用。
(7)	数据库
应用服务后端服务器和普通后端服务器运行所产生的数据都存放在数据库里。为了保证系统的模块化和易维护性，应用服务后端服务器的数据库和普通后端服务器的数据库也是相互独立的。
3.3 前端功能模块设计
经过需求分析，前端功能模块结构设计图如下：

图5 前端主要功能模块图
从总体上看，前端分为相对独立的三个模块：账号搜索模块、普通用户账号管理模块和企业账号管理模块。
   账号搜索模块分为普通用户账号ID搜索、E-mail搜索、企业账号ID搜索三部分。
   普通用户账号管理模块分为审计日志链接、请求日志链接、用户的锁定和解锁、campaigns查看。
   企业账号管理模块分为账号审计日志链接、请求日志链接、企业的上级隶属关系管理、企业账户等级管理、单点登录管理、Consumer Key管理、成员管理。

3.4 后端API设计
后端API包括普通后端服务器的API和应用服务后端服务器的API，其中属于普通后端服务器的API如下：
(1)	和用户账号相关的API
URL	方法	含义
/accounts/{accountId}/state	GET	通过编号查找账户状态
/accounts/{accountId}/parent	GET	通过编号查找上级企业
/accounts/{accountId}/parent	PUT	通过编号设置上级企业
/accounts/{accountId}/branches	GET	通过编号查找下级子公司
/accounts/accounttyes	GET	查询所有账户类型
/accounts/{accountId}/accounttype	PUT	设置账户类型
/accounts/{accountId}/index/documents	DELETE	对账户的所有文档重新索引
(2)	和特性(Features)相关的API
URL	方法	含义
/features/bycountry/{countryName}	GET	通过国家查找特征
/features/byuser/{userId}	GET	通过用户编号查找特征
(3)	和单点登录相关的API
URL	方法	含义
/saml/identityproviders	GET	获取所有身份提供者
/saml/identityproviders/{entityId}	PUT	设置身份提供者
/saml/{companyId}/domains	GET	通过企业编号获取安全域
/saml/{companyId}/domains/{domain}	DELETE	删除一个SAML
/saml/{companyId}/domains/{domain}	PUT	添加或者修改SAML


(4)	其他相关API
URL	方法	含义
/users/credentials	GET	获取用户证明
/users/{userId}	GET	通过编号查询用户
/users/{userId}/companies	GET	查找用户拥有访问权限的所有公司
/users/{userId}/state	PUT	设置用户状态
/users/{userId}/members/{groupId}/{roleId}	PUT	设置成员
/users/{userId}/members/{groupId}	DELETE	删除成员
属于应用服务后端服务器的API如下：
URL	方法	含义
/oauth/companyaccounts/{companyAccountID}	GET	获取消费者列表
/oauth/consumers/{consumerid}	GET	通过consumerid获取消费者信息
/oauth/consumers/{consumerid}/access	POST	激活consumer key
/oauth/consumers/keys/{consumerKey}	DELETE	停用consumer key
